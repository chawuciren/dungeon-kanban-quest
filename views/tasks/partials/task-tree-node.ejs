<% tasks.forEach(task => { %>
  <div class="tree-node" data-task-id="<%= task.id %>" data-level="<%= level %>">
    <div class="node-content">
      <!-- 展开/折叠按钮 -->
      <span class="node-toggle" title="hasChildren: <%= task.hasChildren %>">
        <% if (task.hasChildren) { %>
          <i class="fas fa-chevron-right"></i>
        <% } else { %>
          <!-- 无子任务 -->
        <% } %>
      </span>

      <!-- 任务图标 -->
      <span class="task-icon">
        <% if (task.hasChildren) { %>
          <i class="fas fa-folder text-warning"></i>
        <% } else { %>
          <i class="fas fa-file-alt text-info"></i>
        <% } %>
      </span>

      <!-- 任务标题 -->
      <span class="task-title">
        <a href="/tasks/<%= task.id %>" class="text-decoration-none text-dark">
          <%= task.title %>
        </a>
      </span>

      <!-- 任务元信息 -->
      <span class="task-meta">
        <!-- 星级 -->
        <span class="badge bg-warning">
          <% for(let i = 0; i < task.starLevel; i++) { %>
            <i class="fas fa-star"></i>
          <% } %>
        </span>

        <!-- 技能要求 -->
        <span class="badge bg-secondary">
          <% if (task.skillRequired === 'novice') { %><i class="fas fa-seedling text-success"></i>
          <% } else if (task.skillRequired === 'bronze') { %><i class="fas fa-medal text-warning"></i>
          <% } else if (task.skillRequired === 'silver') { %><i class="fas fa-medal text-light"></i>
          <% } else if (task.skillRequired === 'gold') { %><i class="fas fa-crown text-warning"></i>
          <% } else if (task.skillRequired === 'diamond') { %><i class="fas fa-gem text-info"></i>
          <% } else { %><i class="fas fa-seedling text-success"></i><% } %>
        </span>

        <!-- 紧急程度 -->
        <span class="badge bg-info">
          <% if (task.urgencyLevel === 'urgent') { %><i class="fas fa-fire text-danger"></i>
          <% } else if (task.urgencyLevel === 'important') { %><i class="fas fa-bolt text-warning"></i>
          <% } else if (task.urgencyLevel === 'normal') { %><i class="fas fa-calendar text-primary"></i>
          <% } else if (task.urgencyLevel === 'delayed') { %><i class="fas fa-clock text-warning"></i>
          <% } else if (task.urgencyLevel === 'frozen') { %><i class="fas fa-snowflake text-info"></i>
          <% } else { %><i class="fas fa-calendar text-primary"></i><% } %>
        </span>

        <!-- 任务状态 -->
        <% if (task.status === 'published') { %>
          <span class="badge bg-success">可接单</span>
        <% } else if (task.status === 'assigned') { %>
          <span class="badge bg-primary">进行中</span>
        <% } else if (task.status === 'completed') { %>
          <span class="badge bg-dark">已完成</span>
        <% } else { %>
          <span class="badge bg-secondary"><%= task.status %></span>
        <% } %>

        <!-- 奖励信息 -->
        <span class="badge bg-warning text-dark">
          <% if (task.rewardCurrency === 'diamond') { %><i class="fas fa-gem text-info"></i>
          <% } else if (task.rewardCurrency === 'gold') { %><i class="fas fa-coins text-warning"></i>
          <% } else if (task.rewardCurrency === 'silver') { %><i class="fas fa-circle text-secondary"></i>
          <% } else { %><i class="fas fa-circle text-dark"></i><% } %>
          <%= task.totalBudget %>
        </span>
      </span>

      <!-- 任务操作按钮 -->
      <span class="task-actions">
        <% if (level < 3) { %>
          <button class="btn btn-sm btn-outline-primary add-subtask-btn" data-parent-id="<%= task.id %>" title="添加子任务">
            <i class="fas fa-plus"></i>
          </button>
        <% } %>
        <button class="btn btn-sm btn-outline-secondary view-task-btn" data-task-id="<%= task.id %>" title="查看详情">
          <i class="fas fa-eye"></i>
        </button>
      </span>
    </div>
    <!-- 子任务容器将通过懒加载动态添加 -->
  </div>
<% }) %>


