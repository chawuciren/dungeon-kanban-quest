<div class="list-group-item">
    <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
            <h6 class="mb-1">
                <a href="/tasks/<%= task.id %>" class="text-decoration-none text-dark task-title-link">
                    <%= task.title %>
                </a>
            </h6>
            <small class="text-muted">
                <%
                const stars = 'â­'.repeat(task.starLevel || 1);
                const urgencyIcons = {
                    'urgent': 'ðŸ”¥',
                    'important': 'âš¡',
                    'normal': 'ðŸ“…',
                    'delayed': 'ðŸ•',
                    'frozen': 'â„ï¸'
                };
                const urgencyIcon = urgencyIcons[task.urgencyLevel] || 'ðŸ“…';
                %>
                <%= stars %> <%= task.starLevel || 1 %>æ˜Ÿä»»åŠ¡ â€¢ <%= urgencyIcon %> <%= task.urgencyLevel === 'urgent' ? 'ç´§æ€¥' : task.urgencyLevel === 'important' ? 'é‡è¦' : task.urgencyLevel === 'delayed' ? 'å»¶åŽ' : task.urgencyLevel === 'frozen' ? 'å†»ç»“' : 'æ™®é€š' %>
                <% if (task.project) { %>
                    â€¢ <%= task.project.name %>
                <% } %>
            </small>
        </div>
        <div class="d-flex align-items-center gap-2">
            <%
            const statusBadges = {
                'draft': { class: 'bg-secondary', text: 'è‰ç¨¿' },
                'published': { class: 'bg-primary', text: 'å·²å‘å¸ƒ' },
                'in_progress': { class: 'bg-warning', text: 'è¿›è¡Œä¸­' },
                'review': { class: 'bg-info', text: 'å¾…å®¡æ ¸' },
                'completed': { class: 'bg-success', text: 'å·²å®Œæˆ' },
                'cancelled': { class: 'bg-danger', text: 'å·²å–æ¶ˆ' }
            };
            const statusBadge = statusBadges[task.status] || statusBadges.draft;
            %>
            <span class="badge <%= statusBadge.class %>"><%= statusBadge.text %></span>
            <%
                // æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦æœ‰ç¼–è¾‘æƒé™
                let canEdit = false;
                if (user) {
                    // ç®¡ç†å‘˜å§‹ç»ˆæœ‰æƒé™
                    if (user.role === 'admin') {
                        canEdit = true;
                    }
                    // æˆ‘åˆ›å»ºçš„ä»»åŠ¡
                    else if (task.publisherId === user.id) {
                        canEdit = true;
                    }
                    // æˆ‘è´Ÿè´£çš„ä»»åŠ¡
                    else if (task.assigneeId === user.id) {
                        canEdit = true;
                    }
                    // æˆ‘å®¡æ ¸çš„ä»»åŠ¡
                    else if (task.reviewerId === user.id) {
                        canEdit = true;
                    }
                }
            %>
            <% if (canEdit) { %>
                <a href="/tasks/<%= task.id %>/edit" class="btn btn-outline-secondary btn-sm" title="ç¼–è¾‘ä»»åŠ¡">
                    <i class="fas fa-edit"></i>
                </a>
            <% } %>
        </div>
    </div>
</div>
