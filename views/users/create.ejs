<%- include('../partials/header') %>
<%- include('../helpers/roleHelper') %>

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">
                    <i class="fas fa-user-plus me-2"></i>
                    ğŸ° æ‹›å‹Ÿå†’é™©è€…
                </h1>
                <a href="/users" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>
                    è¿”å›åå†Œ
                </a>
            </div>

            <!-- æ·»åŠ ç”¨æˆ·è¡¨å• -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">å†’é™©è€…æ¡£æ¡ˆ</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="/users/create">
                        <div class="row">
                            <!-- åŸºæœ¬ä¿¡æ¯ -->
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">åŸºæœ¬ä¿¡æ¯</h6>

                                <div class="mb-3">
                                    <label for="firstName" class="form-label">å§“å <span class="text-danger">*</span></label>
                                    <div class="row">
                                        <div class="col-6">
                                            <input type="text" class="form-control" id="firstName" name="firstName"
                                                   placeholder="å§“" required>
                                        </div>
                                        <div class="col-6">
                                            <input type="text" class="form-control" id="lastName" name="lastName"
                                                   placeholder="å" required>
                                        </div>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="username" class="form-label">ç”¨æˆ·å <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="username" name="username"
                                           placeholder="ç”¨æˆ·ç™»å½•å" required>
                                    <div class="form-text">ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œ3-50ä¸ªå­—ç¬¦</div>
                                </div>

                                <div class="mb-3">
                                    <label for="email" class="form-label">é‚®ç®± <span class="text-danger">*</span></label>
                                    <input type="email" class="form-control" id="email" name="email"
                                           placeholder="user@example.com" required>
                                </div>

                                <div class="mb-3">
                                    <label for="phone" class="form-label">æ‰‹æœºå·</label>
                                    <input type="tel" class="form-control" id="phone" name="phone"
                                           placeholder="æ‰‹æœºå·ç ï¼ˆå¯é€‰ï¼‰">
                                </div>

                                <div class="mb-3">
                                    <label for="password" class="form-label">å¯†ç  <span class="text-danger">*</span></label>
                                    <input type="password" class="form-control" id="password" name="password"
                                           placeholder="è‡³å°‘6ä½å¯†ç " required minlength="6">
                                    <div class="form-text">å¯†ç é•¿åº¦è‡³å°‘6ä½</div>
                                </div>
                            </div>

                            <!-- è§’è‰²å’Œæƒé™ -->
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">è§’è‰²å’Œæƒé™</h6>

                                <div class="mb-3">
                                    <label for="role" class="form-label">èŒä¸šè§’è‰² <span class="text-danger">*</span></label>
                                    <select class="form-select" id="role" name="role" required>
                                        <option value="">è¯·é€‰æ‹©èŒä¸š</option>
                                        <option value="guild_master">ğŸ‘‘ å…¬ä¼šç®¡ç†å‘˜ (ç®¡ç†å‘˜) - å†’é™©è€…å…¬ä¼šæ€»ç®¡</option>
                                        <option value="quest_captain">âš”ï¸ æ¢é™©é˜Ÿé•¿ (é¡¹ç›®ç»ç†) - åœ°ä¸‹åŸæ”»ç•¥è§„åˆ’å¸ˆ</option>
                                        <option value="swordsman" selected>ğŸ›¡ï¸ å‰‘å£« (å¼€å‘è€…) - æŒ¥å‰‘æ–©æ•Œçš„å‹‡è€…</option>
                                        <option value="ranger">ğŸ¹ æ¸¸ä¾  (æµ‹è¯•å‘˜) - ä¾¦å¯Ÿå’Œé™·é˜±ä¸“å®¶</option>
                                        <option value="quest_giver">ğŸ’° ä»»åŠ¡å§”æ‰˜äºº (å®¢æˆ·) - å‘å¸ƒåœ°ä¸‹åŸæ¢é™©å§”æ‰˜</option>
                                        <option value="enchanter">âœ¨ é™„é­”å¸ˆ (UIè®¾è®¡å¸ˆ) - è£…å¤‡ç¾åŒ–å¤§å¸ˆ</option>
                                        <option value="alchemist">ğŸ§ª ç‚¼é‡‘æœ¯å¸ˆ (è¿ç»´å·¥ç¨‹å¸ˆ) - è¯å‰‚å’Œè£…å¤‡ç»´æŠ¤ä¸“å®¶</option>
                                    </select>
                                    <div class="form-text">
                                        <small>
                                            <strong>èŒä¸šè¯´æ˜ï¼š</strong><br>
                                            â€¢ å…¬ä¼šç®¡ç†å‘˜ (ç®¡ç†å‘˜)ï¼šæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼Œç®¡ç†æ•´ä¸ªå†’é™©è€…å…¬ä¼š<br>
                                            â€¢ æ¢é™©é˜Ÿé•¿ (é¡¹ç›®ç»ç†)ï¼šè´Ÿè´£åœ°ä¸‹åŸæ”»ç•¥è§„åˆ’å’Œå›¢é˜Ÿç®¡ç†<br>
                                            â€¢ å‰‘å£« (å¼€å‘è€…)ï¼šå‰çº¿æˆ˜æ–—ä¸“å®¶ï¼Œè´Ÿè´£ä»»åŠ¡å¼€å‘å’Œå®ç°<br>
                                            â€¢ æ¸¸ä¾  (æµ‹è¯•å‘˜)ï¼šä¾¦å¯Ÿä¸“å®¶ï¼Œè´Ÿè´£è´¨é‡ä¿è¯å’Œæµ‹è¯•<br>
                                            â€¢ ä»»åŠ¡å§”æ‰˜äºº (å®¢æˆ·)ï¼šå‘å¸ƒæ¢é™©å§”æ‰˜çš„éœ€æ±‚æ–¹<br>
                                            â€¢ é™„é­”å¸ˆ (UIè®¾è®¡å¸ˆ)ï¼šè£…å¤‡ç¾åŒ–ä¸“å®¶ï¼Œè´Ÿè´£ç•Œé¢è®¾è®¡<br>
                                            â€¢ ç‚¼é‡‘æœ¯å¸ˆ (è¿ç»´å·¥ç¨‹å¸ˆ)ï¼šç»´æŠ¤ä¸“å®¶ï¼Œè´Ÿè´£ç³»ç»Ÿè¿ç»´
                                        </small>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label for="skillLevel" class="form-label">æŠ€èƒ½ç­‰çº§</label>
                                    <select class="form-select" id="skillLevel" name="skillLevel">
                                        <option value="novice" selected>ğŸ”° æ–°æ‰‹ - åˆå­¦è€…</option>
                                        <option value="bronze">ğŸ¥‰ é’é“œ - æœ‰ä¸€å®šç»éªŒ</option>
                                        <option value="silver">ğŸ¥ˆ ç™½é“¶ - ç»éªŒä¸°å¯Œ</option>
                                        <option value="gold">ğŸ¥‡ é»„é‡‘ - æŠ€èƒ½ç²¾æ¹›</option>
                                        <option value="diamond">ğŸ’ é’»çŸ³ - é¡¶çº§ä¸“å®¶</option>
                                    </select>
                                    <div class="form-text">æŠ€èƒ½ç­‰çº§å½±å“å¯æ¥å–çš„ä»»åŠ¡éš¾åº¦</div>
                                </div>

                                <div class="mb-3">
                                    <label for="status" class="form-label">è´¦æˆ·çŠ¶æ€</label>
                                    <select class="form-select" id="status" name="status">
                                        <option value="active" selected>âœ… æ´»è·ƒ - æ­£å¸¸ä½¿ç”¨</option>
                                        <option value="inactive">â¸ï¸ æœªæ¿€æ´» - éœ€è¦æ¿€æ´»</option>
                                        <option value="suspended">ğŸš« å·²ç¦ç”¨ - ç¦æ­¢ç™»å½•</option>
                                    </select>
                                </div>

                                <!-- æ¸¸æˆåŒ–ä¿¡æ¯æç¤º -->
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-gift me-1"></i>
                                        æ–°ç”¨æˆ·ç¦åˆ©
                                    </h6>
                                    <p class="mb-0">æ–°ç”¨æˆ·å°†è‡ªåŠ¨è·å¾—ï¼š</p>
                                    <ul class="mb-0 mt-2">
                                        <li>ğŸ¥‡ 100é‡‘å¸ æ–°æ‰‹å¥–åŠ±</li>
                                        <li>ğŸ¯ å®Œæ•´çš„è™šæ‹Ÿé’±åŒ…</li>
                                        <li>ğŸ“Š ä¸ªäººæ•°æ®ç»Ÿè®¡</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- æäº¤æŒ‰é’® -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <hr>
                                <div class="d-flex justify-content-end">
                                    <a href="/users" class="btn btn-secondary me-2">
                                        <i class="fas fa-times me-1"></i>
                                        å–æ¶ˆ
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-user-plus me-1"></i>
                                        æ‹›å‹Ÿå†’é™©è€…
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// è¡¨å•éªŒè¯
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const usernameInput = document.getElementById('username');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');

    // ç”¨æˆ·åéªŒè¯
    usernameInput.addEventListener('input', function() {
        const value = this.value;
        const isValid = /^[a-zA-Z0-9]{3,50}$/.test(value);

        if (value && !isValid) {
            this.classList.add('is-invalid');
            this.setCustomValidity('ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯å’Œæ•°å­—ï¼Œ3-50ä¸ªå­—ç¬¦');
        } else {
            this.classList.remove('is-invalid');
            this.setCustomValidity('');
        }
    });

    // å¯†ç å¼ºåº¦æç¤º
    passwordInput.addEventListener('input', function() {
        const value = this.value;
        const strength = getPasswordStrength(value);

        // ç§»é™¤ä¹‹å‰çš„æç¤º
        const existingFeedback = this.parentNode.querySelector('.password-strength');
        if (existingFeedback) {
            existingFeedback.remove();
        }

        if (value) {
            const feedback = document.createElement('div');
            feedback.className = 'password-strength form-text';
            feedback.innerHTML = `å¯†ç å¼ºåº¦: <span class="badge bg-${strength.color}">${strength.text}</span>`;
            this.parentNode.appendChild(feedback);
        }
    });

    function getPasswordStrength(password) {
        if (password.length < 6) {
            return { color: 'danger', text: 'å¤ªå¼±' };
        } else if (password.length < 8) {
            return { color: 'warning', text: 'ä¸€èˆ¬' };
        } else if (password.length >= 8 && /[A-Z]/.test(password) && /[0-9]/.test(password)) {
            return { color: 'success', text: 'å¼º' };
        } else {
            return { color: 'info', text: 'ä¸­ç­‰' };
        }
    }
});
</script>

<%- include('../partials/footer') %>
