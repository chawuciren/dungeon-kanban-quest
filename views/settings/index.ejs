<%- include('../partials/header') %>

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h3 mb-0">
                    <i class="fas fa-cog me-2"></i>
                    ç”¨æˆ·è®¾ç½®
                </h1>
                <a href="/profile" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>
                    è¿”å›ä¸ªäººèµ„æ–™
                </a>
            </div>

            <!-- è®¾ç½®è¡¨å• -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-sliders-h me-2"></i>
                        ä¸ªäººåå¥½è®¾ç½®
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="/settings">
                        <div class="row">
                            <!-- ä»»åŠ¡è§†å›¾é…ç½® -->
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">
                                    <i class="fas fa-eye me-1"></i>
                                    ä»»åŠ¡è§†å›¾é…ç½®
                                </h6>

                                <!-- é»˜è®¤ä»»åŠ¡è§†å›¾ -->
                                <div class="mb-3">
                                    <label for="defaultTaskView" class="form-label">
                                        é»˜è®¤ä»»åŠ¡è§†å›¾ <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="defaultTaskView" name="defaultTaskView" required>
                                        <option value="list" <%= userSettings.defaultTaskView === 'list' ? 'selected' : '' %>>
                                            ğŸ“‹ åˆ—è¡¨è§†å›¾
                                        </option>
                                        <option value="kanban" <%= userSettings.defaultTaskView === 'kanban' ? 'selected' : '' %>>
                                            ğŸ“Š çœ‹æ¿è§†å›¾
                                        </option>
                                        <option value="gantt" <%= userSettings.defaultTaskView === 'gantt' ? 'selected' : '' %>>
                                            ğŸ“ˆ ç”˜ç‰¹å›¾è§†å›¾
                                        </option>
                                        <option value="tree" <%= userSettings.defaultTaskView === 'tree' ? 'selected' : '' %>>
                                            ğŸŒ³ æ ‘å½¢è§†å›¾
                                        </option>
                                    </select>
                                    <div class="form-text">
                                        è®¿é—®ä»»åŠ¡é¡µé¢æ—¶é»˜è®¤æ˜¾ç¤ºçš„è§†å›¾æ¨¡å¼
                                    </div>
                                </div>

                                <!-- æ¯é¡µæ˜¾ç¤ºä»»åŠ¡æ•°é‡ -->
                                <div class="mb-3">
                                    <label for="tasksPerPage" class="form-label">
                                        æ¯é¡µæ˜¾ç¤ºä»»åŠ¡æ•°é‡ <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="tasksPerPage" name="tasksPerPage" required>
                                        <option value="10" <%= userSettings.tasksPerPage === 10 ? 'selected' : '' %>>10 ä¸ªä»»åŠ¡</option>
                                        <option value="20" <%= userSettings.tasksPerPage === 20 ? 'selected' : '' %>>20 ä¸ªä»»åŠ¡</option>
                                        <option value="50" <%= userSettings.tasksPerPage === 50 ? 'selected' : '' %>>50 ä¸ªä»»åŠ¡</option>
                                        <option value="100" <%= userSettings.tasksPerPage === 100 ? 'selected' : '' %>>100 ä¸ªä»»åŠ¡</option>
                                    </select>
                                    <div class="form-text">
                                        åœ¨åˆ—è¡¨å’Œæ ‘å½¢è§†å›¾ä¸­æ¯é¡µæ˜¾ç¤ºçš„ä»»åŠ¡æ•°é‡
                                    </div>
                                </div>

                                <!-- é»˜è®¤æ’åºæ–¹å¼ -->
                                <div class="mb-3">
                                    <label for="defaultTaskSort" class="form-label">
                                        é»˜è®¤æ’åºæ–¹å¼ <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="defaultTaskSort" name="defaultTaskSort" required>
                                        <option value="created" <%= userSettings.defaultTaskSort === 'created' ? 'selected' : '' %>>
                                            ğŸ•’ æŒ‰åˆ›å»ºæ—¶é—´æ’åº
                                        </option>
                                        <option value="deadline" <%= userSettings.defaultTaskSort === 'deadline' ? 'selected' : '' %>>
                                            â° æŒ‰æˆªæ­¢æ—¥æœŸæ’åº
                                        </option>
                                        <option value="priority" <%= userSettings.defaultTaskSort === 'priority' ? 'selected' : '' %>>
                                            ğŸ”¥ æŒ‰ä¼˜å…ˆçº§æ’åº
                                        </option>
                                    </select>
                                    <div class="form-text">
                                        ä»»åŠ¡åˆ—è¡¨çš„é»˜è®¤æ’åºæ–¹å¼
                                    </div>
                                </div>
                            </div>

                            <!-- ç”˜ç‰¹å›¾å’Œä»»åŠ¡åˆ›å»ºé…ç½® -->
                            <div class="col-md-6">
                                <h6 class="text-muted mb-3">
                                    <i class="fas fa-chart-gantt me-1"></i>
                                    ç”˜ç‰¹å›¾ä¸ä»»åŠ¡é…ç½®
                                </h6>

                                <!-- ç”˜ç‰¹å›¾é»˜è®¤æ—¶é—´ç²’åº¦ -->
                                <div class="mb-3">
                                    <label for="ganttDefaultGranularity" class="form-label">
                                        ç”˜ç‰¹å›¾é»˜è®¤æ—¶é—´ç²’åº¦ <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="ganttDefaultGranularity" name="ganttDefaultGranularity" required>
                                        <option value="day" <%= userSettings.ganttDefaultGranularity === 'day' ? 'selected' : '' %>>
                                            ğŸ“… æ—¥è§†å›¾
                                        </option>
                                        <option value="week" <%= userSettings.ganttDefaultGranularity === 'week' ? 'selected' : '' %>>
                                            ğŸ“† å‘¨è§†å›¾
                                        </option>
                                        <option value="month" <%= userSettings.ganttDefaultGranularity === 'month' ? 'selected' : '' %>>
                                            ğŸ—“ï¸ æœˆè§†å›¾
                                        </option>
                                    </select>
                                    <div class="form-text">
                                        æ‰“å¼€ç”˜ç‰¹å›¾æ—¶é»˜è®¤çš„æ—¶é—´æ˜¾ç¤ºç²’åº¦
                                    </div>
                                </div>

                                <!-- é»˜è®¤ä»»åŠ¡ç±»å‹ -->
                                <div class="mb-3">
                                    <label for="defaultTaskType" class="form-label">
                                        åˆ›å»ºä»»åŠ¡æ—¶é»˜è®¤ç±»å‹ <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="defaultTaskType" name="defaultTaskType" required>
                                        <% taskTypes.forEach(taskType => { %>
                                            <option value="<%= taskType.value %>" <%= userSettings.defaultTaskType === taskType.value ? 'selected' : '' %>>
                                                <%= taskType.icon %> <%= taskType.name %>
                                            </option>
                                        <% }) %>
                                    </select>
                                    <div class="form-text">
                                        åˆ›å»ºæ–°ä»»åŠ¡æ—¶é»˜è®¤é€‰æ‹©çš„ä»»åŠ¡ç±»å‹
                                    </div>
                                </div>

                                <!-- è®¾ç½®è¯´æ˜ -->
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">
                                        <i class="fas fa-info-circle me-1"></i>
                                        è®¾ç½®è¯´æ˜
                                    </h6>
                                    <ul class="mb-0 small">
                                        <li>è¿™äº›è®¾ç½®åªå½±å“æ‚¨ä¸ªäººçš„ä½¿ç”¨ä½“éªŒ</li>
                                        <li>è®¾ç½®ä¼šç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°ç™»å½•</li>
                                        <li>æ‚¨å¯ä»¥éšæ—¶ä¿®æ”¹è¿™äº›é…ç½®</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- æäº¤æŒ‰é’® -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <hr>
                                <div class="d-flex justify-content-end">
                                    <a href="/profile" class="btn btn-secondary me-2">
                                        <i class="fas fa-times me-1"></i>
                                        å–æ¶ˆ
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>
                                        ä¿å­˜è®¾ç½®
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // è¡¨å•éªŒè¯
    const form = document.querySelector('form');
    const tasksPerPageInput = document.getElementById('tasksPerPage');

    // ä»»åŠ¡æ•°é‡éªŒè¯
    tasksPerPageInput.addEventListener('change', function() {
        const value = parseInt(this.value);
        if (isNaN(value) || value < 10 || value > 100) {
            this.classList.add('is-invalid');
            this.setCustomValidity('æ¯é¡µæ˜¾ç¤ºä»»åŠ¡æ•°é‡å¿…é¡»åœ¨10-100ä¹‹é—´');
        } else {
            this.classList.remove('is-invalid');
            this.setCustomValidity('');
        }
    });

    // è¡¨å•æäº¤å‰éªŒè¯
    form.addEventListener('submit', function(e) {
        const tasksPerPage = parseInt(tasksPerPageInput.value);
        if (isNaN(tasksPerPage) || tasksPerPage < 10 || tasksPerPage > 100) {
            e.preventDefault();
            tasksPerPageInput.focus();
            alert('æ¯é¡µæ˜¾ç¤ºä»»åŠ¡æ•°é‡å¿…é¡»åœ¨10-100ä¹‹é—´');
            return false;
        }
    });
});
</script>

<%- include('../partials/footer') %>
