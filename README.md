# Kanban 项目管理系统

一个功能完整的游戏化项目管理工具，摆脱传统敏捷和瀑布模式束缚，采用星级评价和灵活混合的项目管理方式，提供直观有趣的项目管理体验。

## 🚀 项目概述

本项目是一个基于 Node.js 的游戏化项目管理系统，采用 Express 框架构建后端服务，使用模板渲染技术提供前端界面，SQLite 作为数据存储解决方案。系统采用创新的星级评价体系和灵活的混合管理模式，结合赏金任务机制，让项目管理变得更加直观、有趣和高效。

## 📋 核心功能

### 1. 组织与成员管理
- **组织管理**：创建、编辑、删除组织
- **成员管理**：邀请成员、角色分配、权限控制
- **团队协作**：成员间的协作和沟通

### 2. 游戏化项目管理 🎮
- **星级评价体系**：用⭐-⭐⭐⭐⭐⭐直观标注需求和任务难度
- **灵活项目类型**：探索型🗺️、建设型🏗️、竞速型🏃、维护型🔧、混合型🎭
- **动态管理模式**：根据项目阶段和特点灵活切换管理方式
- **智能匹配系统**：基于技能等级和偏好推荐合适任务
- **项目角色**：项目经理、开发者、测试者、产品经理等角色管理
- **项目权限**：基于角色的细粒度权限控制

### 3. 星级事项管理 ⭐
- **事项类型**：任务、需求、Bug、史诗、故事等
- **星级评价**：⭐-⭐⭐⭐⭐⭐标注难度，直观显示复杂程度
- **紧急程度**：🔥紧急、⚡重要、📅普通、🕐延后、❄️冻结
- **技能要求**：🔰新手、🥉铜牌、🥈银牌、🥇金牌、💎钻石
- **事项操作**：创建、编辑、删除、分配、状态变更、竞标接单
- **事项关系**：
  - 父子关系（任务分解）
  - 依赖关系（前置任务）
  - 关联关系（相关事项）
  - 阻塞关系（阻塞/被阻塞）
- **事项属性**：
  - 星级难度（⭐-⭐⭐⭐⭐⭐）
  - 紧急程度（🔥⚡📅🕐❄️）
  - 技能要求（🔰🥉🥈🥇💎）
  - 状态（待办、进行中、测试中、已完成、已关闭）
  - 标签和分类
  - 预估工时和实际工时
  - 截止日期和里程碑
  - 赏金设置和奖励机制

### 4. 看板功能
- **多视图看板**：按状态、按人员、按优先级
- **拖拽操作**：直观的事项状态变更
- **泳道管理**：按不同维度组织看板
- **WIP限制**：工作进行中事项数量限制
- **看板模板**：预设和自定义看板布局

### 5. 甘特图
- **时间线视图**：直观的项目时间规划
- **依赖关系**：任务间的依赖关系可视化
- **里程碑**：重要节点标记
- **进度跟踪**：实时进度更新和预警
- **资源分配**：人员工作负载可视化

### 6. 版本管理
- **版本规划**：版本创建和规划
- **发布管理**：发布计划和发布记录
- **版本对比**：不同版本间的功能对比
- **发布日志**：自动生成发布说明

### 7. 统计与报表
- **项目仪表板**：项目整体状况概览
- **进度报表**：项目进度和完成情况
- **工时统计**：团队和个人工时分析
- **质量报表**：Bug统计和质量趋势
- **燃尽图**：敏捷开发进度跟踪
- **速度图表**：团队开发速度分析

### 8. 日志与审计
- **操作日志**：所有用户操作记录
- **变更历史**：事项变更历史追踪
- **活动流**：项目活动时间线
- **审计报告**：合规性审计支持

### 9. 通知与提醒
- **邮件通知**：重要事件邮件提醒
- **站内消息**：系统内消息通知
- **截止日期提醒**：任务截止日期预警
- **状态变更通知**：事项状态变更通知

### 10. 异世界成员人员管理 🏰
- **项目探险角色体系**：
  - 💰 **任务委托人** (需求方) - 发布项目探险委托
  - ⚔️ **探险队长** (产品经理) - 项目攻略规划师
  - 🛡️ **剑士** (开发者) - 挥剑斩敌的成员
  - 🏹 **游侠** (测试) - 侦察和陷阱专家
  - ✨ **附魔师** (UI设计师) - 装备美化大师
  - 🧪 **炼金术师** (运维) - 药剂和装备维护专家
  - 👑 **组织员** (管理员) - 成员组织总管
- **人员管理功能**：管理员手动添加成员，设置角色和权限
- **角色权限控制**：不同角色拥有不同的系统操作权限
- **成员档案**：详细的个人信息和技能等级管理

### 11. 游戏化赏金系统 🎮
- **虚拟货币体系**：钻石、金币、银币、铜币四级货币
- **赏金任务发布**：任务委托人发布带赏金的探险任务
- **任务接单机制**：探险队长和剑士抢单系统
- **任务拆解奖励**：探险队长拆解任务获得分成
- **完成奖励**：按时完成获得全额奖励
- **逾期惩罚**：延期完成扣除部分奖励
- **资金积累**：按日/月为单位的资金充值系统
- **排行榜系统**：多维度排名展示
- **成就系统**：解锁各种成就徽章
- **工时货币转换**：工时与虚拟货币的兑换机制

## 🛠 技术架构

### 后端技术栈
- **运行环境**：Node.js 18+
- **Web框架**：Express.js
- **数据库**：SQLite 3
- **ORM**：Sequelize
- **身份验证**：JWT + Passport.js
- **模板引擎**：EJS
- **文件上传**：Multer
- **日志管理**：Winston
- **任务调度**：node-cron

### 前端技术栈
- **模板渲染**：EJS
- **样式框架**：Bootstrap 5 + 自定义CSS
- **JavaScript库**：
  - jQuery（DOM操作）
  - Chart.js（图表）
  - FullCalendar（日历）
  - Sortable.js（拖拽）
  - Gantt.js（甘特图）
- **图标库**：Font Awesome

### 开发工具
- **代码规范**：ESLint + Prettier
- **测试框架**：Jest + Supertest
- **API文档**：Swagger
- **进程管理**：PM2

## 📁 项目结构

```
kanban/
├── src/
│   ├── controllers/          # 控制器
│   ├── models/              # 数据模型
│   ├── routes/              # 路由定义
│   ├── middleware/          # 中间件
│   ├── services/            # 业务逻辑
│   ├── utils/               # 工具函数
│   └── config/              # 配置文件
├── views/                   # EJS模板
├── public/                  # 静态资源
│   ├── css/
│   ├── js/
│   ├── images/
│   └── uploads/
├── database/                # 数据库相关
│   ├── migrations/          # 数据库迁移
│   ├── seeders/            # 种子数据
│   └── kanban.db           # SQLite数据库文件
├── tests/                   # 测试文件
├── docs/                    # 项目文档
├── scripts/                 # 脚本文件
├── logs/                    # 日志文件
├── package.json
├── .env.example
└── README.md
```

## 🗄 数据库设计

### 核心表结构
- **organizations** - 组织表
- **users** - 用户表
- **projects** - 项目表
- **project_members** - 项目成员表
- **roles** - 角色表
- **permissions** - 权限表
- **items** - 事项表（任务、需求、Bug等）
- **item_relations** - 事项关系表
- **boards** - 看板表
- **board_columns** - 看板列表
- **versions** - 版本表
- **releases** - 发布表
- **comments** - 评论表
- **attachments** - 附件表
- **activity_logs** - 活动日志表
- **notifications** - 通知表

### 游戏化系统表结构
- **user_wallets** - 用户钱包表（存储各种货币余额和冻结金额）
- **currency_transactions** - 货币交易记录表（所有收支流水）
- **bounty_tasks** - 赏金任务表（任务赏金信息和状态）
- **task_bids** - 任务竞标表（产品经理和开发者的竞标记录）
- **work_hour_records** - 工时记录表（预估工时和实际工时）
- **leaderboards** - 排行榜表（各种排名数据）
- **achievements** - 成就表（成就定义和规则）
- **user_achievements** - 用户成就表（用户获得的成就）
- **daily_checkins** - 每日签到表（签到奖励记录）
- **penalty_records** - 惩罚记录表（超时惩罚和信誉记录）

## 🚦 开发计划

### 第一阶段：基础架构
1. 项目初始化和环境配置
2. 数据库设计和模型创建
3. 用户认证和授权系统
4. 基础路由和中间件

### 第二阶段：核心功能
1. 组织和用户管理
2. 项目管理基础功能
3. 事项管理（CRUD）
4. 基础看板功能

### 第三阶段：游戏化系统
1. 虚拟货币系统实现
2. 赏金任务发布和接单机制
3. 工时管理和奖励计算
4. 排行榜和成就系统

### 第四阶段：高级功能
1. 甘特图实现
2. 统计报表
3. 版本管理
4. 通知系统

### 第五阶段：优化完善
1. 性能优化
2. 用户体验优化
3. 测试完善
4. 文档完善

## 📝 许可证

MIT License

## 🔧 安装和运行

### 环境要求
- Node.js 18.0+
- npm 8.0+
- SQLite 3

### 安装步骤
```bash
# 克隆项目
git clone <repository-url>
cd kanban

# 安装依赖
npm install

# 配置环境变量
cp .env.example .env

# 初始化数据库
npm run db:migrate
npm run db:seed

# 启动开发服务器
npm run dev
```

### 环境变量配置
```env
# 应用配置
NODE_ENV=development
PORT=3000
APP_NAME=Kanban项目管理系统

# 数据库配置
DB_PATH=./database/kanban.db

# JWT配置
JWT_SECRET=your-secret-key
JWT_EXPIRES_IN=7d

# 邮件配置
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=your-email@example.com
SMTP_PASS=your-password

# 文件上传配置
UPLOAD_PATH=./public/uploads
MAX_FILE_SIZE=10485760
```

## � 游戏化项目管理模式详解

### 核心设计理念
- **去模式化**：不再固定敏捷或瀑布，根据项目特点灵活组合
- **星级评价**：用直观的星级系统替代复杂的指标
- **角色驱动**：基于角色能力和偏好匹配任务
- **动态调整**：项目过程中可灵活调整管理方式

### � 异世界成员角色体系

#### 项目探险角色映射
```
💰 任务委托人 (需求方) - 发布项目探险委托的雇主
⚔️ 探险队长 (产品经理) - 项目攻略规划师，负责任务分解和队伍指挥
🛡️ 剑士 (开发者) - 挥剑斩敌的成员，核心战斗人员
🏹 游侠 (测试) - 侦察和陷阱专家，发现系统弱点和Bug
✨ 附魔师 (UI设计师) - 装备美化大师，负责界面设计和用户体验
🧪 炼金术师 (运维) - 药剂和装备维护专家，系统运维和部署
👑 组织员 (管理员) - 成员组织总管，系统最高权限
```

### �🌟 星级指标体系

#### 需求星级标注
```
⭐ 一星需求：简单功能，1-3天完成
⭐⭐ 二星需求：常规功能，3-7天完成
⭐⭐⭐ 三星需求：复杂功能，1-2周完成
⭐⭐⭐⭐ 四星需求：核心功能，2-4周完成
⭐⭐⭐⭐⭐ 五星需求：重大功能，1个月以上
```

#### 任务星级标注
```
⭐ 一星任务：基础任务，半天内完成
⭐⭐ 二星任务：常规任务，1-2天完成
⭐⭐⭐ 三星任务：复杂任务，3-5天完成
⭐⭐⭐⭐ 四星任务：核心任务，1-2周完成
⭐⭐⭐⭐⭐ 五星任务：关键任务，2周以上
```

#### 紧急程度标注
```
🔥 紧急：立即处理，优先级最高
⚡ 重要：本周内处理
📅 普通：按计划处理
🕐 延后：可推迟处理
❄️ 冻结：暂停处理
```

#### 技能要求标注
```
🔰 新手：初级成员可处理
🥉 铜牌：有一定经验要求
🥈 银牌：需要中级成员
🥇 金牌：需要高级成员
💎 钻石：需要传奇级成员
```

### 🎯 游戏化项目类型

#### 1. 探索型项目 🗺️
- **特点**：需求不明确，需要边做边调整
- **管理方式**：短周期迭代，快速试错
- **适用场景**：创新项目、概念验证
- **奖励机制**：探索奖励 + 创新奖励

#### 2. 建设型项目 🏗️
- **特点**：需求明确，按计划执行
- **管理方式**：里程碑管理，阶段交付
- **适用场景**：系统开发、功能实现
- **奖励机制**：里程碑奖励 + 质量奖励

#### 3. 竞速型项目 🏃
- **特点**：时间紧迫，需要快速交付
- **管理方式**：并行开发，资源集中
- **适用场景**：紧急需求、市场抢占
- **奖励机制**：速度奖励 + 加班补贴

#### 4. 维护型项目 🔧
- **特点**：持续优化，小步快跑
- **管理方式**：看板管理，持续改进
- **适用场景**：Bug修复、性能优化
- **奖励机制**：稳定奖励 + 改进奖励

#### 5. 混合型项目 🎭
- **特点**：根据阶段切换管理模式
- **管理方式**：动态调整，灵活组合
- **适用场景**：大型项目、复杂项目
- **奖励机制**：综合奖励 + 适应奖励

## 🔐 安全特性

### 身份认证
- **多因素认证**：支持TOTP、短信验证
- **单点登录**：LDAP/AD集成
- **密码策略**：强密码要求、定期更换

### 权限控制
- **RBAC模型**：基于角色的访问控制
- **细粒度权限**：功能级、数据级权限控制
- **权限继承**：组织、项目、事项权限继承

### 数据安全
- **数据加密**：敏感数据加密存储
- **审计日志**：完整的操作审计记录
- **备份恢复**：自动备份和恢复机制

## 📊 性能指标

### 系统性能
- **响应时间**：页面加载 < 2秒
- **并发用户**：支持1000+并发用户
- **数据容量**：支持百万级事项数据

### 可用性
- **系统可用性**：99.9%
- **故障恢复**：< 5分钟
- **数据一致性**：强一致性保证

## 🌐 国际化支持

- **多语言**：中文、英文（可扩展）
- **时区支持**：自动时区转换
- **本地化**：日期、数字格式本地化

## 📱 移动端适配

- **响应式设计**：支持各种屏幕尺寸
- **触摸优化**：移动端交互优化
- **离线支持**：基础功能离线可用

## 🎮 游戏化赏金系统详解

### 虚拟货币体系
- **钻石** 💎：最高级货币，1钻石 = 1000金币，用于重要需求和紧急任务
- **金币** 🥇：高级货币，1金币 = 100银币，用于核心功能开发
- **银币** 🥈：中级货币，1银币 = 100铜币，用于一般功能和优化
- **铜币** 🥉：基础货币，用于简单任务和Bug修复

### 核心设计原则
- **工时独立**：工时仅作为项目管理和完成度评判指标，不直接参与货币计算
- **奖励预扣**：发布任务时预扣奖励金作为激励池
- **达标返还**：工时未达标时返还预扣金额给需求方
- **风险可控**：需求方最多承担基础成本，超标可获得退款

### 赏金任务流程

#### 1. 需求发布阶段
```
需求方发布任务：
- 设置总预算：100金币
- 系统自动分配：
  ├── 基础奖励：80金币（确定消耗）
  └── 奖励金：20金币（预扣激励）
- 资金冻结：100金币从账户冻结
```

#### 2. 任务拆解阶段
```
产品经理接单：
- 拆解为子任务
- 预估各子任务工时
- 设置截止时间
- 获得拆解奖励：基础奖励的10-15%（8-12金币）
```

#### 3. 开发完成阶段
```
工时达标判断：
✅ 实际工时 ≤ 预估工时：
   - 开发者获得：基础奖励 + 奖励金（88金币）
   - 需求方消耗：100金币

❌ 实际工时 > 预估工时：
   - 开发者获得：基础奖励 × 折扣系数
   - 需求方退回：奖励金 + 差额
   - 需求方实际消耗：减少后的金额
```

### 工时管理机制

#### 工时评估标准
- **预估工时**：产品经理基于技术复杂度和历史数据预估
- **实际工时**：开发者真实投入时间记录
- **达标标准**：实际工时不超过预估工时即为达标
- **协商机制**：特殊情况下可协商调整预估工时

#### 超时惩罚机制
```
折扣系数计算：
- 轻微超时（1-20%）：折扣系数 0.9
- 中度超时（21-50%）：折扣系数 0.8
- 严重超时（51-100%）：折扣系数 0.7
- 极度超时（>100%）：折扣系数 0.6
```

### 资金流转示例

#### 场景1：按时完成（理想情况）
```
需求发布：100金币预算
├── 需求方账户：-100金币（冻结）
├── 系统奖励池：+100金币

任务完成：工时达标
├── 产品经理获得：12金币（拆解奖励）
├── 开发者获得：88金币（基础68 + 奖励20）
├── 需求方最终消耗：100金币
```

#### 场景2：工时超标（惩罚情况）
```
需求发布：100金币预算
├── 需求方账户：-100金币（冻结）
├── 系统奖励池：+100金币

任务完成：工时超标30%
├── 产品经理获得：12金币（拆解奖励不变）
├── 开发者获得：54.4金币（基础68 × 0.8折扣）
├── 需求方退回：33.6金币（20奖励金 + 13.6差额）
├── 需求方最终消耗：66.4金币
```

### 资金管理系统
- **充值机制**：
  - 日充值：每日固定额度（如100金币）
  - 月充值：每月大额度（如3000金币 + 10钻石）
  - 项目预算：项目启动时一次性分配
- **冻结机制**：发布任务时冻结相应资金
- **消费记录**：详细的资金流水和消费明细
- **余额管理**：实时余额显示和预警机制

### 排行榜系统
- **财富榜**：按总资产排名（钻石+金币+银币+铜币）
- **效率榜**：按工时达标率和任务完成质量排名
- **贡献榜**：按完成任务数量排名
- **信誉榜**：按任务按时完成率排名
- **月度/季度/年度榜单**：不同时间维度的排名

### 成就系统
- **新手成就**：完成首个任务、首次接单等
- **效率成就**：连续工时达标、快速完成等
- **质量成就**：零Bug完成、高质量交付等
- **财富成就**：累计收入里程碑
- **贡献成就**：帮助他人、知识分享等

### 风险控制机制
- **工时超标惩罚**：基于超标程度的折扣系数
- **信誉系统**：连续超标影响接单权限和信誉评级
- **协商机制**：特殊情况下的工时调整和申诉流程
- **仲裁机制**：争议处理和公平裁决机制

## 🧪 测试策略

### 测试类型
- **单元测试**：覆盖率 > 80%
- **集成测试**：API接口测试
- **端到端测试**：关键业务流程测试
- **性能测试**：负载测试、压力测试

### 质量保证
- **代码审查**：强制代码审查流程
- **自动化测试**：CI/CD集成自动化测试
- **质量门禁**：测试通过才能发布

## 🚀 部署方案

### 开发环境
- **本地开发**：Docker Compose一键启动
- **热重载**：代码变更自动重启
- **调试支持**：VS Code调试配置

### 生产环境
- **容器化部署**：Docker + Docker Compose
- **负载均衡**：Nginx反向代理
- **进程管理**：PM2集群模式
- **监控告警**：日志监控、性能监控

## 🤝 贡献指南

### 开发规范
- **代码风格**：ESLint + Prettier
- **提交规范**：Conventional Commits
- **分支策略**：Git Flow
- **文档要求**：代码注释、API文档

### 参与方式
1. Fork项目
2. 创建功能分支
3. 提交代码变更
4. 创建Pull Request
5. 代码审查和合并

---

**注意**：这是一个功能完整的项目管理系统规划，包含了现代项目管理工具的所有核心功能。项目将采用模块化设计，便于后续扩展和维护。系统设计充分考虑了可扩展性、安全性和用户体验，可以满足不同规模团队的项目管理需求。
