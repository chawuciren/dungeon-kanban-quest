# 技术栈与架构偏好
- 服务运行在端口3216，调试通过用户手动进行
- 使用Node.js + Express技术栈构建项目，SQLite存储数据，前端采用模板渲染
- 偏好服务端渲染，非必要不写API接口，使用传统POST表单提交而非AJAX
- 将所有路由逻辑直接放在router文件中，不单独使用controller
- Bootstrap JS、jQuery和自定义JS脚本引用放在header中，避免加载顺序问题
- 偏好使用FontAwesome图标而非emoji实现UI元素
- 所有页面使用撑满屏幕的布局设计，包括头部也应默认撑满

# 项目功能与设计
- 构建看板型项目管理工具，包含组织管理、项目管理、事项管理、看板、甘特图等功能
- 项目包含迭代概念但没有版本概念
- 项目（大陆）关联多个公会，用户角色（职业）在项目级别管理，一个用户可拥有多个角色权限
- 任务管理系统包含需求、故事、史诗等不同类型任务分类

# 任务管理视图与交互
- 任务页面支持三种视图：甘特图、看板方式、树形子任务视图
- 任务页面支持下拉菜单被遮挡问题，包括tasks/tree.ejs和tasks/index.ejs，需要应用相同的z-index层级修复方案
- 树形视图默认全部收起只展示第一层，通过点击展开按钮懒加载下一层
- 树形视图外观样式与列表视图保持一致，只增加展开子任务功能
- 任务列表界面设计紧凑：高度更小，发布者等信息放同一行，操作按钮通过下拉菜单弹出
- 保留列表中直接编辑负责人和状态等字段的快速编辑功能
- 任务列表中标题默认点击跳转到详情页面
- 列表视图和树形视图都添加直接添加子任务的按钮（在下拉菜单中）
- 甘特图左侧任务列表与右侧时间轴高度对齐，默认时间粒度为天，任务列表为树形模式
- 甘特图界面需要左右两侧选中状态同步：选择左侧任务条目时右侧对应甘特图条要高亮底色，选择右侧甘特图条时左侧对应任务也要高亮
- 甘特图任务条颜色需要为所有状态分配不同颜色，右侧时间轴应该根据任务状态分配对应颜色，甘特图颜色设计需要更好的区分度
- 暂时移除百分比进度条功能，专注于状态颜色的正确映射
- 下拉菜单z-index值设置更大，避免被其他元素遮盖
- 任务列表头部设计：单一灰色条，固定高度30px，不显示多余文字
- 甘特图时间轴定位应使用固定的日宽度来计算偏移量，而不是依赖元素宽度比例，优先修复日粒度视图，周月视图后续处理
- 任务类型标签应该占满一行高度，可以放在标题前或后，并且需要在所有视图（列表、树状、看板、甘特图）中统一显示任务类型

# 用户权限与导航
- 基于角色的导航权限：管理员始终显示大陆、公会、勇者管理功能
- 普通用户必须先选择大陆才能访问其他功能，选择后在头部显示当前大陆名称
- 未选择大陆时，隐藏酒馆、探险季和荣誉殿堂等导航菜单项
- 项目级页面基于当前选中的大陆显示数据，只有荣誉殿堂例外显示全局统计
- 管理员角色可操作所有数据，需特别考虑管理员的全局访问权限
- 仪表盘显示不限制项目的用户相关信息，勇者大厅导航始终显示

# 任务与表单设计
- 任务创建和编辑复用同一模板，支持选择父任务、起始日期和截止日期
- 迭代为可选项（可以不属于任何迭代）
- 迭代创建表单中的团队工时容量字段应设为必填项，默认值为0
- 协助人员字段显示为'参与人'，审核人员字段显示为'审核人'
- 参与人选择组件使用列表加复选框形式
- 任务只保留星级字段，移除技能要求字段
- 任务发布必填字段：标题、描述、难度、任务类型、紧急程度、预估工时、起始日期、截止日期、负责人、审核人
- 任务创建表单的默认值设置：任务类型为任务，难度1星，紧急程度普通，工时0，起始日期和截止日期都默认为当天
- 任务编辑功能需要添加实际工时字段
- 任务权限系统设计：管理员和项目负责人拥有全部权限；客户可创建史诗和故事；产品经理可创建需求；测试可创建bug；开发可创建普通任务；任务修改权限限制为负责人、创建人（不能修改为已完成状态）；基于项目成员权限字段扩充设计.
- 任务类型需要扩展为：通用任务、开发任务、设计任务、测试任务、运维任务，对应各角色的专用任务类型，开发和测试等角色仍可创建通用任务.
- 星级(starLevel)代表任务难度，紧急程度(urgencyLevel)代表优先级，不要混淆这两个概念
- 任务需要添加进度或百分比概念，与归档状态功能一起进行数据库迁移
- 任务状态应保留：草稿(draft)、已发布(published)、进行中(in_progress)、待审核(review)、已完成(completed)、已取消(cancelled)，去掉bidding和assigned状态
- 任务状态简化：待接单、竞标中等状态不再需要，应从数据库、任务列表、编辑创建等所有相关地方移除这些状态

# 货币与奖励系统
- 每日签到系统：普通用户获得少量铜币，委托贵族（客户）角色获得额外奖励
- 签到奖励具体数值（基础奖励、管理员额外奖励、客户额外奖励）提取到配置文件中
- 货币兑换功能使用跳转新页面而非弹出框，支持任意币种互换
- 兑换比例放在配置文件中，默认1000:1比例（如1000铜币换1银币）
- 货币兑换界面：分别选择原始币种和目标币种，支持双向数量输入

# 开发流程与数据管理
- 在开发阶段不需要纠结数据迁移，直接修改基础模型和数据库初始化脚本即可。

# 错误处理
- 用户偏好统一错误处理：将验证错误页面合并到系统现有的error页面中，移除自定义的validation模板，保持错误处理的一致性